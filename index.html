<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Despesas Cirurtec</title>

<link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#0f172a">

<style>
body{font-family:Arial;margin:0;background:#f1f5f9}
header{background:#0f172a;color:#fff;padding:15px;text-align:center}
main{padding:15px}
input,button{width:100%;padding:10px;margin:5px 0}
button{background:#2563eb;color:#fff;border:none;border-radius:5px}
.card{background:#fff;padding:15px;border-radius:8px;margin-bottom:10px}
.danger{background:#dc2626}
</style>
</head>

<body>
<header>
<img src="logo.png" style="max-height:50px"><br>
Despesas Cirurtec
</header>

<main id="app"></main>

<script>
let viagem = JSON.parse(localStorage.getItem('viagem'));

function salvarViagem(){
  const desc = document.getElementById('desc').value;
  const adi = Number(document.getElementById('adi').value);
  if(!desc || !adi){
    alert('Preencha a descrição e o adiantamento');
    return;
  }
  viagem = {desc,adi,despesas:[]};
  localStorage.setItem('viagem',JSON.stringify(viagem));
  render();
}

function addDespesa(){
  const d = document.getElementById('d').value;
  const v = Number(document.getElementById('v').value);
  if(!d || !v) return;
  viagem.despesas.push({d,v});
  localStorage.setItem('viagem',JSON.stringify(viagem));
  render();
}

function finalizar(){
  if(!confirm('Tem certeza que deseja finalizar esta viagem? Após isso os dados serão apagados.')) return;
  localStorage.removeItem('viagem');
  viagem=null;
  alert('Viagem finalizada. (PDF será incluído na próxima etapa)');
  render();
}

function render(){
  const app=document.getElementById('app');
  if(!viagem){
    app.innerHTML=`
    <div class="card">
      <h3>Nova Viagem</h3>
      <input id="desc" placeholder="Descrição da viagem">
      <input id="adi" type="number" placeholder="Valor do adiantamento">
      <button onclick="salvarViagem()">Iniciar Viagem</button>
    </div>`;
    return;
  }

  let total=viagem.despesas.reduce((s,x)=>s+x.v,0);
  app.innerHTML=`
  <div class="card">
    <b>${viagem.desc}</b><br>
    Adiantamento: R$ ${viagem.adi.toFixed(2)}<br>
    Total gasto: R$ ${total.toFixed(2)}<br>
    Saldo: R$ ${(viagem.adi-total).toFixed(2)}
  </div>

  <div class="card">
    <h3>Nova Despesa</h3>
    <input id="d" placeholder="Descrição">
    <input id="v" type="number" placeholder="Valor">
    <button onclick="addDespesa()">Adicionar</button>
  </div>

  <button class="danger" onclick="finalizar()">Finalizar Viagem</button>
  `;
}

render();
</script>
</body>
</html>
